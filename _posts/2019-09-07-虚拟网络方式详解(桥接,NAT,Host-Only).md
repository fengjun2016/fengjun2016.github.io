---
layout:     post
title:      虚拟机的网络方式详解
subtitle:   桥接、Nat、Host-only
date:       2019-07-10
author:     fengfeng
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - 虚拟机
    - 网络
---

## 前言

`虚拟机`就是利用真实机的环境用软件的方式模拟成真实机系统的一个软件。

而现在虚拟机软件都内置了几种虚拟系统的上网方式，一般有三种, 分别是`桥接(Bridge)`、`Nat(地址转换)`、`Host-only(单独户网络)`。


那么这三种虚拟机的联网方式都分别是什么工作原理呢?

> 在各家各户家庭用的网络常见的就是从电信、联通、长城这些`ISP网络服务提供商`接入的光纤，也就是常见的`ADSL`拨号上网，那么这种方式最恼火的就是您的一条`ADSL`线路只能提供给`一台电脑`上网,如果您想要`多台电脑`上网的话，我们就需要购买一个`路由器`，搭建一个`局域网`，其结构图如下类似：



![](https://tva1.sinaimg.cn/large/007S8ZIlgy1giwxlk2us1j30k30q9dip.jpg)



### Nat(地址转换)


`Nat`就是指`网络地址转换(NAT,NetworkAddress Translation)`, 其意思就是讲一个`Ip`地址分成几个`Ip`的方法，广泛用于`广域网`, 那我们的虚拟机使用`Nat`是什么意思呢? 是如何来实现的呢?下面来看一张结构图:

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gixgcsjoyij30t80iotaf.jpg)

上面就是我们生活中最常见的上网方式，以及`Nat`的图示。  

上图中`pc2`、`pc3`为我们的真机，`pc4`、`pc5`为分别是我们`pc2`、`pc3`上创建的虚拟机。  

如果给虚拟机使用了`Nat`的网络通信方式的话，那么虚拟机将使用真机上的`Ip`地址，但是却不跟真机的`Ip`地址一致，而是真机将他们的地址进行了`Nat`转换，比如说，`pc2` 上`Ip`地址为`192.168.1.88` 通过`Nat`以后假设地址为 `10.2.15.2~255`，那么建立在`pc2`上的虚拟机的`pc4`的`Ip`地址就会在`10.2.15.2---10.2.15.255` 选择一个作为自己的`Ip`地址。

`此时我们的真机和虚拟机是可以相互通信的。`

* 当虚拟机要访问外网，比如www.hao123.com, 假设虚拟机的Ip是10.2.15.8,真实机的Ip地址是192.168.18.3,那么虚拟机要上网，比如要访问www.hao123.com,首先会用虚拟机自己的Ip去访问www.baidu.com,但是是要通过我们的真实主机去上网的，前面不是说了吗, 虚拟机的地址是真机转换而来的，如果要访问外网的话，就必须要先经过真机再次转换，也即是将10.2.15.8转成真实机的Ip地址(192.168.18.3)去访问www.hao123.com。

    > 虚拟机发布访问www.hao123.com的请求(10.2.15.8) ----> 经过真实机把10.2.15.8.转换为192.168.18.3 ---> 路由器将192.168.18.3转换为外网ip 211.167.97.67提交访问www.hao123.com的请求数据包

* 大家一定要注意, `NAT`网络方式不管真实机可不可以联网，虚拟机都可以和我们的主机真实机通讯， 而虚拟机要上网必须要满足真实机可以上网才行。


### 桥接(Bridge)

当虚拟机使用桥接网络方式以后，实际上`这台虚拟机就是一台单独的机器`，什么意思呢？  

这样给大家说，如果您是通过路由器上网，真实机的`Ip`是通过路由器自动获得的`Ip`为`192.168.18.8`, 虚拟机一旦设置了桥接网络模式，那么他也会向我们的上级路由器获取`Ip`地址，这个时候虚拟机的`Ip`地址就应该和真实的`Ip`地址在一个网络范围内(同一子网)也会在`192.168.18.0/25`;  

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gixgnpdjnzj30ru0n4wge.jpg)

如上图所示,`pc2`、`pc3`是我们的真实机，`pc4`、`pc5`分别是上面2个真实机上面的虚拟机上面的虚拟机。

* 那么如果使用桥接网络的话`pc4`、`pc5`虽然是运行在上面，但实际上他们是直接和`路由器`进行通讯的，不和主机打交道，`唯一有联系`的地方也就是真实机运行了这个虚拟机系统软件，`借用`了真实机的`网卡`罢了，虽然我们再说桥接模式和真实机没有关系，但是这个时候虚拟机连和外面通讯的网卡硬件设备都没了当然也不能上网。  

* 由于真实机是无效网内`Ip`,所以真实机无法联网,但是虚拟机缺完全可以和外界互通。  

* 也就是说当选择桥接模式后，真实机和虚拟机就是两台完全不相干的，真实机能否上网，和虚拟机没有任何关系，虚拟机这个时候在乎的是上级统一子网的设备有没有自动分配`Ip`的功能，至于真实机不能上网， 跟虚拟机能否上网也没有关系。  

* 我们通过连线到路由器，会发现，我们的虚拟机的确是直接通过路由器在上网，`Ip是路由器分配给他的，和真实主机没有关系。`

### Host-only

这种模式就是`虚拟机自己完全不能和外界通信`，相当于您家里买了一台电脑没有联网是一样的，很简单!!!!
